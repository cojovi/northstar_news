<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FW36LNRENF"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-FW36LNRENF');
    </script>
    
    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="48x48" href="/favicon-48x48.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon-180x180.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="/favicon-192x192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="/favicon-512x512.png" />
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="/site.webmanifest" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://thenorthstarledger.com/" />
    <meta property="og:title" content="The Northstar Ledger" />
    <meta property="og:description" content="News, politics, business, and culture. Your community. Your stories. Uncover the Northstar." />
    <meta property="og:site_name" content="The Northstar Ledger" />
    <meta property="og:image" content="https://thenorthstarledger.com/og/default.jpg" />
    <meta property="og:image:secure_url" content="https://thenorthstarledger.com/og/default.jpg" />
    <meta property="og:image:type" content="image/jpeg" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content="The Northstar Ledger - News, Culture & Discovery" />
    <meta property="og:locale" content="en_US" />
    
    <!-- Twitter / X -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://thenorthstarledger.com/" />
    <meta name="twitter:title" content="The Northstar Ledger" />
    <meta name="twitter:description" content="News, politics, business, and culture. Your community. Your stories. Uncover the Northstar." />
    <meta name="twitter:image" content="https://thenorthstarledger.com/og/default.jpg" />
    <meta name="twitter:image:alt" content="The Northstar Ledger - News, Culture & Discovery" />
    
    <link rel="canonical" href="https://thenorthstarledger.com/" />
    <link rel="alternate" type="application/rss+xml" title="The Northstar Ledger RSS" href="https://thenorthstarledger.com/rss.xml" />
    <link rel="alternate" type="application/atom+xml" title="The Northstar Ledger Atom" href="https://thenorthstarledger.com/atom.xml" />
    <title>The Northstar Ledger</title>
    <script>
      // Set dark mode by default before page renders to prevent flash
      (function() {
        const theme = localStorage.getItem('theme') || 'dark';
        document.documentElement.classList.add(theme);
      })();
    </script>
    <script>
      // Set canonical URL and update OG meta tags dynamically based on current path
      (function() {
        const path = window.location.pathname;
        const canonical = document.querySelector('link[rel="canonical"]');
        if (canonical && path !== '/') {
          canonical.href = 'https://thenorthstarledger.com' + path;
        }

        // Update OG meta tags for article pages
        // Try to read from inline manifest first (synchronous), then fallback to fetch
        function updateOGTags(manifest) {
          if (!manifest) return;
          
          // Extract route (remove leading slash, e.g., "/politics/article-slug" -> "politics/article-slug")
          const route = path.slice(1);
          const articleData = manifest[route];
          
          if (articleData && articleData.hero_image) {
            // Update or create OG meta tags
            const updateMetaTag = (property, content) => {
              let meta = document.querySelector(`meta[property="${property}"]`) || 
                        document.querySelector(`meta[name="${property}"]`);
              if (!meta) {
                meta = document.createElement('meta');
                if (property.startsWith('og:')) {
                  meta.setAttribute('property', property);
                } else {
                  meta.setAttribute('name', property);
                }
                document.head.appendChild(meta);
              }
              meta.setAttribute('content', content);
            };

            // Update OG tags
            updateMetaTag('og:title', articleData.title);
            updateMetaTag('og:description', articleData.dek);
            updateMetaTag('og:image', articleData.hero_image);
            updateMetaTag('og:image:secure_url', articleData.hero_image);
            updateMetaTag('og:url', articleData.url || `https://thenorthstarledger.com${path}`);
            updateMetaTag('og:type', 'article');
            
            // Update Twitter tags
            updateMetaTag('twitter:title', articleData.title);
            updateMetaTag('twitter:description', articleData.dek);
            updateMetaTag('twitter:image', articleData.hero_image);
            updateMetaTag('twitter:url', articleData.url || `https://thenorthstarledger.com${path}`);
            
            // Update page title
            document.title = `${articleData.title} - The Northstar Ledger`;
          }
        }

        // Only update for article pages (not home, search, about)
        if (path !== '/' && path !== '/search' && path !== '/about') {
          // Try inline manifest first (synchronous)
          const manifestScript = document.getElementById('og-manifest');
          if (manifestScript && manifestScript.textContent) {
            try {
              const manifest = JSON.parse(manifestScript.textContent);
              updateOGTags(manifest);
            } catch (e) {
              console.debug('Error parsing inline manifest:', e);
            }
          }
          
          // Fallback to fetch (async)
          fetch('/og-manifest.json')
            .then(response => response.json())
            .then(manifest => updateOGTags(manifest))
            .catch(error => {
              // Silently fail if manifest doesn't exist
              console.debug('OG manifest not available:', error);
            });
        }
      })();
    </script>
    <script id="og-manifest" type="application/json">{}</script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
